<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIèŠå¤©çª—å£æµ‹è¯• - MaxGamer</title>

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .test-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .test-btn:hover {
            transform: scale(1.05);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f0f0f0;
        }

        .success {
            color: #10b981;
        }

        .error {
            color: #ef4444;
        }
    </style>

    <!-- åŠ è½½AIèŠå¤©çª—å£CSS -->
    <link rel="stylesheet" href="css/ai-chat-window.css">
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¤– AIèŠå¤©çª—å£æµ‹è¯•</h1>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•èŠå¤©çª—å£åŠŸèƒ½</p>

        <button class="test-btn" onclick="openChat()">æ‰“å¼€èŠå¤©çª—å£</button>
        <button class="test-btn" onclick="testAPI()">æµ‹è¯•AI API</button>

        <div class="status" id="status">
            ç­‰å¾…æµ‹è¯•...
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #f9fafb; border-radius: 10px; text-align: left;">
            <h3 style="margin-top: 0;">ğŸ“‹ æ£€æŸ¥æ¸…å•ï¼š</h3>
            <div id="checklist"></div>
        </div>
    </div>

    <!-- åŠ è½½AIèŠå¤©çª—å£è„šæœ¬ -->
    <script src="js/ai-chat-window.js"></script>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
        window.addEventListener('load', function() {
            const checklist = document.getElementById('checklist');
            const checks = [];

            // æ£€æŸ¥AIèŠå¤©çª—å£æ˜¯å¦åŠ è½½
            if (window.aiChatWindow) {
                checks.push('âœ… ai-chat-window.js å·²åŠ è½½');
            } else {
                checks.push('âŒ ai-chat-window.js æœªåŠ è½½');
            }

            // æ£€æŸ¥AIèŠå¤©çª—å£æ˜¯å¦åˆå§‹åŒ–
            if (window.aiChatWindow && window.aiChatWindow.container) {
                checks.push('âœ… èŠå¤©çª—å£å·²åˆå§‹åŒ–');
            } else {
                checks.push('âŒ èŠå¤©çª—å£æœªåˆå§‹åŒ–');
            }

            // æ£€æŸ¥CSSæ˜¯å¦åŠ è½½
            const chatWindow = document.querySelector('.ai-chat-window');
            if (chatWindow) {
                checks.push('âœ… èŠå¤©çª—å£DOMå·²åˆ›å»º');
            } else {
                checks.push('âŒ èŠå¤©çª—å£DOMæœªåˆ›å»º');
            }

            checklist.innerHTML = checks.join('<br>');
        });

        function openChat() {
            const status = document.getElementById('status');

            if (window.aiChatWindow) {
                window.aiChatWindow.open();
                status.innerHTML = '<span class="success">âœ… èŠå¤©çª—å£å·²æ‰“å¼€ï¼</span>';
            } else {
                status.innerHTML = '<span class="error">âŒ AIèŠå¤©çª—å£æœªåŠ è½½</span>';
            }
        }

        async function testAPI() {
            const status = document.getElementById('status');
            status.innerHTML = 'â³ æ­£åœ¨æµ‹è¯•AI API...';

            try {
                const response = await fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        interaction_type: 'comment',
                        message: 'ä½ å¥½',
                        context: {
                            platform: 'MaxGamer',
                            page: 'test',
                            count: 1,
                            language: 'zh-CN'
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        status.innerHTML = `<span class="success">âœ… APIæµ‹è¯•æˆåŠŸï¼<br>AIå›å¤: ${data.message}</span>`;
                    } else {
                        status.innerHTML = `<span class="error">âŒ APIè¿”å›å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                    }
                } else {
                    status.innerHTML = `<span class="error">âŒ HTTPé”™è¯¯: ${response.status} ${response.statusText}</span>`;
                }
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
