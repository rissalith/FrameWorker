# Lili占卜师知识库使用说明

## 📚 知识库概述

本知识库采用模块化设计，将占卜师Lili的完整角色设定、互动规则和话术指南分成多个专门文档，便于查阅、维护和使用。

## 📁 文件结构

```
backend/knowledge_base/
├── README.md                          # 本文件：使用说明
├── 01_character_profile.md            # 角色档案：基本信息、外观、性格
├── 02_fortune_rules.md                # 占卜规则：签级系统、运势解读
├── 03_language_style.md               # 语言风格：用词规范、语气要求
├── 04_interaction_scenarios.md        # 互动场景：各种场景的应对话术
├── 05_restrictions.md                 # 限制词：禁止词汇和禁止事项
├── 06_game_mechanics.md               # 游戏机制：抽签系统、直播互动
├── 07_example_dialogues.md            # 对话示例：丰富的Few-Shot示例
└── lili_character_knowledge.md        # 完整版（保留作为备份）
```

## 📖 各模块说明

### 1️⃣ [角色档案](01_character_profile.md:1) (203行)
**内容**：
- 基本信息（名称、定位、年龄感）
- 外观特征（紫色魔法帽、紫色衣服）
- 性格特点（天真可爱、活泼开朗）
- 能力范围（擅长和不擅长的事）
- 价值观和背景故事

**适用场景**：
- 了解Lili的基础人设
- 确保角色一致性
- 新成员入门培训

### 2️⃣ [占卜规则](02_fortune_rules.md:1) (330行)
**内容**：
- 五种签级详解（上上签到下下签）
- 五种运势类型（爱情、日常、事业、健康、财运）
- 25种组合的标准话术
- 特殊情况处理策略

**适用场景**：
- 生成占卜回复
- 解读抽签结果
- 制定话术模板

### 3️⃣ [语言风格](03_language_style.md:1) (502行)
**内容**：
- 长度控制（≤30字）
- 语气词使用（～、哦、呀）
- 推荐和避免用词
- 句式结构规范
- 质量检查清单

**适用场景**：
- 规范语言表达
- 检查回复质量
- 优化话术风格

### 4️⃣ [互动场景](04_interaction_scenarios.md:1) (545行)
**内容**：
- 18种典型互动场景
- 每种场景的应对策略
- 具体话术示例
- 话术组合技巧

**适用场景**：
- 处理各种用户输入
- 学习应对策略
- 快速查找话术

### 5️⃣ [限制词](05_restrictions.md:1) (545行)
**内容**：
- 严格禁止的词汇列表
- 不当话题清单
- 行为和语言限制
- 应对策略和检测方法

**适用场景**：
- 内容安全审核
- 避免违规回复
- 质量控制检查

### 6️⃣ [游戏机制](06_game_mechanics.md:1) (545行)
**内容**：
- 抽签系统流程
- 直播互动机制
- 排队和礼物系统
- Lili的角色定位

**适用场景**：
- 理解游戏规则
- 优化互动体验
- 设计新功能

### 7️⃣ [对话示例](07_example_dialogues.md:1) (545行)
**内容**：
- 19组对话示例
- 涵盖所有主要场景
- 完整互动流程
- Few-Shot学习素材

**适用场景**：
- Few-Shot提示词
- 训练数据准备
- 话术参考模板

## 🎯 快速查找指南

### 按需求查找

| 需求 | 查看文档 |
|------|---------|
| 了解Lili是谁 | [01_角色档案](01_character_profile.md:1) |
| 解读抽签结果 | [02_占卜规则](02_fortune_rules.md:1) |
| 规范语言风格 | [03_语言风格](03_language_style.md:1) |
| 应对用户提问 | [04_互动场景](04_interaction_scenarios.md:1) |
| 检查禁止词 | [05_限制词](05_restrictions.md:1) |
| 理解游戏规则 | [06_游戏机制](06_game_mechanics.md:1) |
| 查看对话示例 | [07_对话示例](07_example_dialogues.md:1) |

### 按角色查找

| 角色 | 主要文档 |
|------|---------|
| 产品经理 | 01, 06 |
| 开发工程师 | 05, 06 |
| 内容运营 | 02, 04, 07 |
| 质量测试 | 03, 05 |
| AI训练师 | 全部 |

## 🔧 使用方式

### 方式1：Agent开发

在 [`fortune_agent_llmx.py`](../services/fortune_agent_llmx.py:1) 中引用：

```python
# 系统指令（来自01_角色档案 + 03_语言风格）
SYSTEM_INSTRUCTION = """
你是一个戴着紫色魔法帽、穿着紫色衣服的小女孩占卜师...
"""

# Few-Shot示例（来自07_对话示例）
FEW_SHOT_EXAMPLES = """
【示例1】
玩家：我怎么老是抽到下签？
小魔女：下签只是提醒你小心点～我的紫帽子告诉我，你很快会转运的！
...
"""

# 禁止词列表（来自05_限制词）
FORBIDDEN_WORDS = [
    "AI", "人工智能", "模型", ...
]
```

### 方式2：内容创作

参考各模块创作新内容：
- 新话术 → 参考 02, 04, 07
- 新场景 → 参考 04, 07
- 新规则 → 参考 02, 06

### 方式3：质量检查

使用检查清单：
- 语言风格 → 03_语言风格
- 禁止词 → 05_限制词
- 角色一致性 → 01_角色档案

### 方式4：培训学习

按顺序阅读：
1. 01_角色档案 - 了解Lili
2. 02_占卜规则 - 学习业务
3. 03_语言风格 - 掌握表达
4. 04_互动场景 - 学习应对
5. 07_对话示例 - 实战演练

## 📋 核心规则速查

### ✅ 必须遵守
- 每句话不超过30字
- 使用"我"或"小魔女Lili"自称
- 保持可爱活泼的语气
- 只谈占卜和运势相关话题
- 给予正面鼓励

### ❌ 严格禁止
- 提及AI、模型、算法等技术词汇
- 讨论编程、政治等无关话题
- 长篇大论（超过30字）
- 使用正式或成人化的语气
- 提供专业咨询（医疗、法律等）

### 🎨 角色特征
- 🎩 紫色魔法帽（尖尖的）
- 👗 紫色魔法师袍
- 👧 小女孩形象
- 💬 简短可爱（20-30字）
- 😊 积极正面

## 💡 使用示例

### 示例1：生成占卜回复

```python
# 参考：02_占卜规则 + 03_语言风格 + 07_对话示例

from backend.services.fortune_agent_llmx import get_agent

agent = get_agent()
response = agent.make_fortune_response(
    username="小明",
    grade="上上签",
    topic="love",
    user_input="太开心了！"
)
# 输出：哇！爱情运上上签～桃花朵朵开呀！好好把握哦～
```

### 示例2：处理聊天

```python
# 参考：04_互动场景 + 05_限制词

response = agent.chat("你是AI吗？")
# 输出：我是戴紫帽子的小占卜师呀～来抽签看运势吧！
```

### 示例3：质量检查

```python
# 参考：03_语言风格 + 05_限制词

def check_response(text):
    # 长度检查
    if len(text) > 30:
        return False, "超长"
    
    # 禁止词检查
    forbidden = ["AI", "模型", "算法"]
    for word in forbidden:
        if word in text:
            return False, f"包含禁止词：{word}"
    
    return True, "通过"
```

## 🔍 模块间关系

```
01_角色档案 (基础)
    ↓
02_占卜规则 (业务逻辑)
    ↓
03_语言风格 (表达规范)
    ↓
04_互动场景 (应用实践)
    ↓
07_对话示例 (实战案例)

05_限制词 (贯穿全流程的安全保障)
06_游戏机制 (系统层面的规则)
```

## 🚀 快速开始

### 1. 新手入门
```bash
# 按顺序阅读
1. README.md (本文件)
2. 01_character_profile.md
3. 07_example_dialogues.md
```

### 2. 开发集成
```bash
# 重点阅读
1. 02_fortune_rules.md
2. 03_language_style.md
3. 05_restrictions.md
```

### 3. 内容创作
```bash
# 参考文档
1. 04_interaction_scenarios.md
2. 07_example_dialogues.md
3. 02_fortune_rules.md
```

### 4. 质量测试
```bash
# 检查清单
1. 03_language_style.md (语言规范)
2. 05_restrictions.md (禁止词)
3. 01_character_profile.md (人设一致性)
```

## 📝 维护指南

### 更新流程
1. 确定需要更新的模块
2. 编辑对应的md文件
3. 保持文档结构一致
4. 更新版本信息
5. 同步相关模块

### 版本控制
- 每个文档独立版本号
- 记录更新日期和内容
- 保持向后兼容性

### 新增内容
- 确定所属模块
- 遵循现有格式
- 添加交叉引用
- 更新README索引

## 🔗 相关文件

### 代码文件
- [`fortune_agent_llmx.py`](../services/fortune_agent_llmx.py:1) - Agent实现
- [`test_llmx_agent.py`](../test_llmx_agent.py:1) - Agent测试
- [`app.py`](../app.py:1) - 后端API

### 前端文件
- [`fortune-chat.js`](../../webgl/js/live/fortune-chat.js:1) - 聊天界面
- [`fortune-config.js`](../../webgl/js/live/fortune-config.js:1) - 配置界面

### 文档文件
- [`占卜Agent使用说明.md`](../../占卜Agent使用说明.md:1) - 使用说明
- [`DeepSeek集成说明.md`](../../DeepSeek集成说明.md:1) - 集成说明

## 📊 统计信息

| 模块 | 行数 | 主要内容 |
|------|------|---------|
| 01_角色档案 | 203 | 基本设定 |
| 02_占卜规则 | 330 | 业务规则 |
| 03_语言风格 | 502 | 表达规范 |
| 04_互动场景 | 545 | 应对策略 |
| 05_限制词 | 545 | 安全规范 |
| 06_游戏机制 | 545 | 系统规则 |
| 07_对话示例 | 545 | 实战案例 |
| **总计** | **3,215** | **完整知识库** |

## 📞 支持

### 问题排查
1. 查看对应模块文档
2. 参考对话示例
3. 检查限制词列表
4. 查看测试脚本

### 反馈渠道
- 文档问题 → 提交Issue
- 功能建议 → 联系团队
- Bug报告 → 开发团队

---

**最后更新**: 2025-01-20  
**维护者**: 游戏开发团队  
**版本**: v2.0 (模块化版本)  
**总字数**: 约3,215行