# 本地服务快速启动指南

## 问题诊断

您遇到的错误：
```
docker: Error response from daemon: Ports are not available: exposing port TCP 0.0.0.0:3306 -> 0.0.0.0:0: listen tcp 0.0.0.0:3306: bind: Only one usage of each socket address (protocol/network address/port) is normally permitted.
```

**原因**：您的电脑上已经运行了本地 MySQL 服务（MySQL80 和 MySQL84），占用了 3306 端口。

## 解决方案

### 步骤 1：停止本地 MySQL 服务

**右键点击** `stop-mysql.bat` 文件，选择 **"以管理员身份运行"**

这将停止以下服务：
- MySQL80
- MySQL84

### 步骤 2：启动 Docker 服务

**双击运行** `start-docker-services.bat`

这将启动以下容器：
1. **MySQL 8.0** - 端口 3306
   - 用户名: root
   - 密码: maxgamer_root_2024
   - 数据库: maxgamer

2. **Redis 7** - 端口 6379
   - 密码: redis_pass_2024

3. **Nginx** - 端口 80
   - 网关服务

### 步骤 3：验证服务状态

运行以下命令检查服务：
```bash
docker ps --filter "name=maxgamer-"
```

应该看到 3 个运行中的容器。

## 常见问题

### Q1: 如果还是提示端口被占用怎么办？

检查是否还有其他进程占用端口：
```bash
netstat -ano | findstr :3306
```

如果发现其他进程，记下进程 ID (PID)，然后：
```bash
tasklist | findstr <PID>
```

### Q2: 如何停止所有 Docker 服务？

```bash
docker stop maxgamer-mysql maxgamer-redis maxgamer-nginx
docker rm maxgamer-mysql maxgamer-redis maxgamer-nginx
```

### Q3: 如何重启本地 MySQL 服务？

如果您想恢复使用本地 MySQL：
```bash
net start MySQL80
```

## 下一步

服务启动后，您可以：

1. **初始化数据库**
   ```bash
   cd MaxGamer/backend
   python init_db.py
   ```

2. **启动后端服务**
   ```bash
   cd MaxGamer/backend
   python start.py
   ```

3. **访问前端**
   - 打开浏览器访问: http://localhost

## 注意事项

⚠️ **重要**：
- 停止 MySQL 服务需要管理员权限
- Docker 服务使用官方镜像，无需构建
- 数据会保存在 Docker 容器中，删除容器会丢失数据
- 如需持久化数据，请使用 Docker volumes

## 服务端口总览

| 服务 | 端口 | 说明 |
|------|------|------|
| MySQL | 3306 | 数据库服务 |
| Redis | 6379 | 缓存服务 |
| Nginx | 80 | 网关服务 |
| 后端 API | 5000 | Python Flask (需手动启动) |
| 游戏服务 | 5001 | Fortune Game (需手动启动) |

## 故障排除

如果遇到问题，请按以下顺序检查：

1. ✅ Docker Desktop 是否正在运行
2. ✅ 本地 MySQL 服务是否已停止
3. ✅ 端口是否被其他程序占用
4. ✅ Docker 镜像是否下载成功
5. ✅ 网络连接是否正常

需要帮助？查看详细文档：
- [Docker 部署文档](DOCKER_DEPLOYMENT.md)
- [Windows Docker 设置](WINDOWS_DOCKER_SETUP.md)
- [端口配置说明](PORT_CONFIGURATION.md)