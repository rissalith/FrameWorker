# MaxGamer è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬éƒ¨ç½² MaxGamer å¹³å°ï¼Œå®ç°**å‰åç«¯ã€æ•°æ®åº“ã€å¹³å°å’Œæ¸¸æˆçš„å®Œå…¨éš”ç¦»**ã€‚

## æ¶æ„è®¾è®¡

### éš”ç¦»å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MaxGamer éš”ç¦»æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å‰ç«¯å®¹å™¨    â”‚  â”‚   åç«¯å®¹å™¨    â”‚  â”‚  æ•°æ®åº“å®¹å™¨   â”‚      â”‚
â”‚  â”‚  (Nginx)     â”‚  â”‚  (Flask API) â”‚  â”‚ (PostgreSQL) â”‚      â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚      â”‚
â”‚  â”‚ - é™æ€æ–‡ä»¶    â”‚  â”‚ - API æœåŠ¡   â”‚  â”‚ - ç”¨æˆ·æ•°æ®    â”‚      â”‚
â”‚  â”‚ - æ¸¸æˆå‰ç«¯    â”‚  â”‚ - ä¸šåŠ¡é€»è¾‘   â”‚  â”‚ - æ¸¸æˆæ•°æ®    â”‚      â”‚
â”‚  â”‚   (åªè¯»)     â”‚  â”‚ - æ¸¸æˆç®¡ç†   â”‚  â”‚ - å¹³å°ç»‘å®š    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                â”‚                 â”‚              â”‚
â”‚          â”‚    HTTP/REST   â”‚     SQL         â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                           â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Redis ç¼“å­˜  â”‚  â”‚  æ¸¸æˆå®¹å™¨ 1   â”‚  â”‚  æ¸¸æˆå®¹å™¨ 2   â”‚      â”‚
â”‚  â”‚   (éš”ç¦»)     â”‚  â”‚ (FortuneæŠ–éŸ³) â”‚  â”‚ (FortuneTwitch)â”‚    â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚      â”‚
â”‚  â”‚ - Session    â”‚  â”‚ - æ¸¸æˆé€»è¾‘   â”‚  â”‚ - æ¸¸æˆé€»è¾‘   â”‚      â”‚
â”‚  â”‚ - Token      â”‚  â”‚ - æ¸¸æˆæ•°æ®   â”‚  â”‚ - æ¸¸æˆæ•°æ®   â”‚      â”‚
â”‚  â”‚ - ä¸´æ—¶æ•°æ®    â”‚  â”‚   (éš”ç¦»)     â”‚  â”‚   (éš”ç¦»)     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½‘ç»œéš”ç¦»

1. **å‰ç«¯ç½‘ç»œ** (`maxgamer-frontend-network`)
   - å‰ç«¯å®¹å™¨ç‹¬ç«‹ç½‘ç»œ
   - é€šè¿‡ä»£ç†è®¿é—®åç«¯

2. **åç«¯ç½‘ç»œ** (`maxgamer-backend-network`)
   - åç«¯ã€å‰ç«¯ã€Redis é€šä¿¡
   - å¯¹å¤–æš´éœ² API

3. **æ•°æ®åº“ç½‘ç»œ** (`maxgamer-db-network`)
   - **å†…éƒ¨ç½‘ç»œ** (internal: true)
   - ä»…åç«¯å¯è®¿é—®
   - å¤–éƒ¨å®Œå…¨éš”ç¦»

4. **æ¸¸æˆç½‘ç»œ** (`maxgamer-game-network`)
   - **å†…éƒ¨ç½‘ç»œ** (internal: true)
   - æ¸¸æˆå®¹å™¨åªèƒ½ä¸åç«¯é€šä¿¡
   - æ¸¸æˆä¹‹é—´å®Œå…¨éš”ç¦»

### æ•°æ®éš”ç¦»

```
./data/
â”œâ”€â”€ postgres/        # æ•°æ®åº“æ•°æ®ï¼ˆPostgreSQLï¼‰
â”‚   â””â”€â”€ frameworker.db (æ—§ç‰ˆ SQLiteï¼ŒåºŸå¼ƒ)
â”œâ”€â”€ redis/          # Redis ç¼“å­˜æ•°æ®
â”œâ”€â”€ vector_db/      # RAG å‘é‡æ•°æ®åº“
â”œâ”€â”€ uploads/        # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
â””â”€â”€ games/          # æ¸¸æˆä¸“ç”¨æ•°æ®
    â”œâ”€â”€ fortune-douyin/    # æŠ–éŸ³ç‰ˆæ¸¸æˆæ•°æ®
    â””â”€â”€ fortune-twitch/    # Twitch ç‰ˆæ¸¸æˆæ•°æ®
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†ä»£ç ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/WistonPeng/Max-Gamer-Platform.git
cd Max-Gamer-Platform

# ç¡®ä¿ Docker å’Œ Docker Compose å·²å®‰è£…
docker --version
docker-compose --version
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env  # æˆ–ä½¿ç”¨ vim
```

**å¿…é¡»é…ç½®çš„å…³é”®å˜é‡**ï¼š

```bash
# å®‰å…¨å¯†é’¥ï¼ˆç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼‰
SECRET_KEY=$(python3 -c "import secrets; print(secrets.token_urlsafe(32))")
JWT_SECRET=$(python3 -c "import secrets; print(secrets.token_urlsafe(32))")

# æ•°æ®åº“å¯†ç 
DB_PASSWORD=your_secure_database_password_here

# Redis å¯†ç 
REDIS_PASSWORD=your_secure_redis_password_here

# Twitch OAuth
TWITCH_CLIENT_SECRET=your_twitch_client_secret_here
TWITCH_REDIRECT_URI=https://your-domain.com/api/auth/platform-callback/twitch
```

### 3. è¿è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²
./deploy.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… æ‹‰å–æœ€æ–°ä»£ç 
- âœ… å¤‡ä»½ç°æœ‰æ•°æ®åº“
- âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- âœ… æ„å»º Docker é•œåƒ
- âœ… å¯åŠ¨æ‰€æœ‰éš”ç¦»å®¹å™¨
- âœ… ç­‰å¾…æœåŠ¡å°±ç»ª
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… åˆ›å»ºç®¡ç†å‘˜è´¦å·
- âœ… æ³¨å†Œæ¸¸æˆ
- âœ… éªŒè¯éƒ¨ç½²

## éƒ¨ç½²é€‰é¡¹

### é€‰é¡¹ 1ï¼šç®€å•éƒ¨ç½²ï¼ˆSQLite + å•å®¹å™¨ï¼‰

é€‚ç”¨äºå¼€å‘ç¯å¢ƒæˆ–å°è§„æ¨¡éƒ¨ç½²ã€‚

```bash
# ä½¿ç”¨é»˜è®¤çš„ docker-compose.yml
docker-compose up -d
```

### é€‰é¡¹ 2ï¼šéš”ç¦»éƒ¨ç½²ï¼ˆPostgreSQL + å¤šå®¹å™¨ï¼‰

**æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ**ï¼Œæä¾›å®Œå…¨éš”ç¦»ã€‚

```bash
# ä½¿ç”¨éš”ç¦»ç‰ˆ docker-compose
docker-compose -f docker-compose.isolated.yml up -d
```

### é€‰é¡¹ 3ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

**æœ€æ¨è**ï¼Œè‡ªåŠ¨å¤„ç†æ‰€æœ‰æ­¥éª¤ã€‚

```bash
./deploy.sh

# è·³è¿‡æ•°æ®åº“å¤‡ä»½
./deploy.sh --skip-backup

# ä»…æ›´æ–°ä»£ç ï¼Œä¸åˆå§‹åŒ–æ•°æ®åº“
./deploy.sh --skip-init
```

## éƒ¨ç½²åæ“ä½œ

### è®¿é—®æœåŠ¡

- **å‰ç«¯é¡µé¢**: http://your-server:8080
- **åç«¯ API**: http://your-server:3000/api
- **æ¸¸æˆå¸‚åœº**: http://your-server:8080/game-market.html
- **è®¾ç½®é¡µé¢**: http://your-server:8080/settings.html

### ç®¡ç†å‘˜ç™»å½•

```
é‚®ç®±: admin@maxgamer.local
å¯†ç : pXw1995
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f                    # æ‰€æœ‰å®¹å™¨
docker-compose logs -f maxgamer-backend   # ä»…åç«¯
docker-compose logs -f maxgamer-frontend  # ä»…å‰ç«¯
docker-compose logs -f maxgamer-db        # ä»…æ•°æ®åº“

# è¿›å…¥å®¹å™¨
docker-compose exec maxgamer-backend bash  # åç«¯å®¹å™¨
docker-compose exec maxgamer-db psql -U maxgamer_user -d maxgamer  # æ•°æ®åº“

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# å®Œå…¨æ¸…ç†ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰
docker-compose down -v  # âš ï¸ å±é™©ï¼šä¼šåˆ é™¤æ‰€æœ‰æ•°æ®å·
```

## æ•°æ®å¤‡ä»½ä¸æ¢å¤

### è‡ªåŠ¨å¤‡ä»½

éƒ¨ç½²è„šæœ¬ä¼šåœ¨æ¯æ¬¡éƒ¨ç½²å‰è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“åˆ° `./backups/` ç›®å½•ã€‚

### æ‰‹åŠ¨å¤‡ä»½

```bash
# PostgreSQL å¤‡ä»½
docker-compose exec maxgamer-db pg_dump -U maxgamer_user maxgamer > backup_$(date +%Y%m%d).sql

# Redis å¤‡ä»½
docker-compose exec maxgamer-redis redis-cli --raw SAVE
cp ./data/redis/dump.rdb ./backups/redis_$(date +%Y%m%d).rdb
```

### æ¢å¤æ•°æ®

```bash
# PostgreSQL æ¢å¤
cat backup_20231209.sql | docker-compose exec -T maxgamer-db psql -U maxgamer_user -d maxgamer

# Redis æ¢å¤
docker-compose stop maxgamer-redis
cp ./backups/redis_20231209.rdb ./data/redis/dump.rdb
docker-compose start maxgamer-redis
```

## å®‰å…¨åŠ å›º

### 1. æ›´æ”¹é»˜è®¤å¯†ç 

```bash
# ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„æ‰€æœ‰å¯†ç 
nano .env

# æ›´æ”¹æ•°æ®åº“å¯†ç 
DB_PASSWORD=your_new_secure_password

# æ›´æ”¹ Redis å¯†ç 
REDIS_PASSWORD=your_new_redis_password
```

### 2. å¯ç”¨é˜²ç«å¢™

```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 22/tcp    # SSH
sudo ufw enable
```

### 3. é…ç½® HTTPS (SSL/TLS)

```bash
# å®‰è£… Certbot
sudo apt-get install certbot

# è·å– SSL è¯ä¹¦
sudo certbot certonly --standalone -d your-domain.com

# æ›´æ–° nginx.conf å¯ç”¨ SSL
# é‡å¯å‰ç«¯å®¹å™¨
docker-compose restart maxgamer-frontend
```

## ç›‘æ§ä¸ç»´æŠ¤

### æŸ¥çœ‹èµ„æºä½¿ç”¨

```bash
# å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# ç£ç›˜ä½¿ç”¨
du -sh ./data/*
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ—¥å¿—å¤§å°
du -sh ./logs/*

# æ¸…ç†æ—§æ—¥å¿—ï¼ˆ7å¤©å‰ï¼‰
find ./logs -name "*.log" -mtime +7 -delete
```

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:3000/api/health
curl http://localhost:8080/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker-compose exec maxgamer-db pg_isready -U maxgamer_user
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs maxgamer-backend

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3000

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache
docker-compose up -d
```

### é—®é¢˜ 2: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
docker-compose ps maxgamer-db

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs maxgamer-db

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker-compose exec maxgamer-backend python -c "from database import get_db_session; db=get_db_session(); print('Connected')"
```

### é—®é¢˜ 3: æ¸¸æˆæ— æ³•åŠ è½½

```bash
# æ£€æŸ¥æ¸¸æˆåº“æŒ‚è½½
docker-compose exec maxgamer-backend ls -la /app/GameLibrary

# é‡æ–°æ³¨å†Œæ¸¸æˆ
docker-compose exec maxgamer-backend python register_games.py

# æ£€æŸ¥æ¸¸æˆ API
curl http://localhost:3000/api/games
```

## æ›´æ–°å‡çº§

### æ›´æ–°ä»£ç 

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°éƒ¨ç½²
./deploy.sh --skip-backup  # è·³è¿‡å¤‡ä»½åŠ å¿«éƒ¨ç½²
```

### æ»šåŠ¨æ›´æ–°ï¼ˆé›¶åœæœºï¼‰

```bash
# 1. æ„å»ºæ–°é•œåƒ
docker-compose build

# 2. é€ä¸ªæ›´æ–°å®¹å™¨
docker-compose up -d --no-deps --build maxgamer-backend
docker-compose up -d --no-deps --build maxgamer-frontend
```

## æ‰©å±•ä¸å®šåˆ¶

### æ·»åŠ æ–°æ¸¸æˆå®¹å™¨

ç¼–è¾‘ `docker-compose.isolated.yml`:

```yaml
game-your-new-game:
  build:
    context: ./GameLibrary/platform/your-new-game
    dockerfile: Dockerfile
  container_name: game-your-new-game
  restart: unless-stopped

  networks:
    - maxgamer-game-network
    - maxgamer-backend-network

  volumes:
    - ./data/games/your-new-game:/app/data

  environment:
    - GAME_ID=your-new-game
    - PLATFORM=platform
    - API_BASE_URL=http://maxgamer-backend:5000
```

### é…ç½®è´Ÿè½½å‡è¡¡

```bash
# å®‰è£… Nginx
sudo apt-get install nginx

# é…ç½®åå‘ä»£ç†
sudo nano /etc/nginx/sites-available/maxgamer

# æ·»åŠ è´Ÿè½½å‡è¡¡é…ç½®
upstream maxgamer_backend {
    server localhost:3000;
    server localhost:3001;  # ç¬¬äºŒä¸ªåç«¯å®ä¾‹
}
```

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- ğŸ“– [å®Œæ•´æ–‡æ¡£](DEPLOYMENT.md)
- ğŸ› [GitHub Issues](https://github.com/WistonPeng/Max-Gamer-Platform/issues)
- ğŸ“ åç«¯æ—¥å¿—: `./logs/backend/`
- ğŸ“ å‰ç«¯æ—¥å¿—: `./logs/nginx/`
